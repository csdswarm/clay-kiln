{{#unless @root.locals.edit}}
  <script type="text/javascript">
    (function() {
      const _sf_async_config = window._sf_async_config = (window._sf_async_config || {});
      /** CONFIGURATION START **/
      _sf_async_config.uid = 65686;
      _sf_async_config.domain = window.location.hostname;
      _sf_async_config.useCanonical = true;
      _sf_async_config.sections = ''; // 'Market, Category, Format, Callsign' ex: 'Los Angeles,Music,Alternative,KROQ-FM'
      _sf_async_config.authors = '';
      /** CONFIGURATION END **/

      function loadChartbeat() {
        const e = document.createElement('script');
        const n = document.getElementsByTagName('script')[0];
        const mainContent = document.querySelector('[role="main"]') || {};
        const main = mainContent ? mainContent.dataset : {};
        _sf_async_config.authors = main.authors.split(', ').join();
        _sf_async_config.sections = ['National', ...(main.sectionFront ? [`national-${main.sectionFront}`] : []), 'editorial'].join();
        e.type = 'text/javascript';
        e.async = true;
        e.src = '//static.chartbeat.com/js/chartbeat.js';
        n.parentNode.insertBefore(e, n);
      }

      loadChartbeat();
    })();

    /**
     * Create virtual page views for SPA
     *
     * Object passed in must contain path & title, authors and sections are optional
     */
    document.addEventListener('pageView', function (event) {
      const details = event.detail || {},
        content = details.toArticlePage || details.toGalleryPage || {},
        authors = (content.authors || []).map(({text}) => text),
        sectionFront = content.sectionFront ? [`national-${content.sectionFront}`] : [],
        sections = ['National', ...sectionFront, 'editorial'];

      pSUPERFLY.virtualPage({
        sections: sections.join(),
        authors: authors.join(),
        path: details.toPath || window.location.pathname,
        title: details.toTitle || document.title
      });
    });
  </script>
{{/unless}}
