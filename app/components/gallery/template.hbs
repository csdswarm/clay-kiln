<section role="main"
  data-track-type="gallery-detail"
  data-uri="{{ default _ref _self }}"
  class="component component--gallery{{ if @root.locals.edit ' editing' }} gallery--{{sectionFront}}"
  itemscope
  itemtype="http://schema.org/CollectionPage"
  data-section-front="{{ sectionFront }}"
  data-syndication="{{ syndicationStatus }}"
  data-headline="{{ striptags headline }}"
  data-authors="{{ join (map authors (getProp "text")) }}"
  data-sources="{{ join (map sources (getProp "text")) }}"
  data-publish-date="{{ formatLocalDate date 'YYYY-MM-DD' }}"
  data-tags="{{ join (map tags.items (getProp "text")) }}"
  data-station-slug="{{ stationSlug }}">

  {{> breadcrumbs this }}
  <header class="gallery__header">
    {{! gallery microdata }}
    <meta itemprop="url" content="{{ @root.locals.url }}" />
    <meta itemprop="mainEntityOfPage" content="{{ @root.locals.url }}" />
    <div itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{{ @root.locals.site.name }}" />
      <meta itemprop="sameAs" content="http://{{ @root.locals.site.host }}{{ @root.locals.site.path }}" />
      <div itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
        <meta itemprop="url" content="http://{{ @root.locals.site.host }}{{ @root.locals.site.path }}/media/sites/{{ @root.locals.site.slug }}/logo.w600.h60.png" />
        <meta itemprop="height" content="60" />
        <meta itemprop="width" content="600" />
      </div>
    </div>
    <div itemprop="image" itemscope itemtype="http://schema.org/ImageObject">
      <meta itemprop="url" content="{{ feedImgUrl }}" />
      <meta itemprop="height" content="{{ extractImgHeight feedImgUrl }}" />
      <meta itemprop="width" content="{{ extractImgWidth feedImgUrl }}" />
    </div>

    {{! title }}
    <h1 class="header__primary" data-editable="headline" itemprop="headline">{{{ headline }}}</h1>
    {{! subtitle }}
    {{#ifAny @root.locals.edit subHeadline}}
      <span class="header__secondary" data-editable="subHeadline" itemprop="subheadline">{{{ subHeadline }}}</span>
    {{/ifAny}}
  </header>

  {{#if _computed.renderFullWidthLead }}
    {{! Lead }}
    <div class="lead lead--full-width" data-editable="lead">
      {{> component-list lead }}
    </div>
  {{/if}}

  {{> google-ad-manager contentPageSponsorLogo }}

  <section class="gallery__body"
    {{#if (includes lead.0._ref '_components/instagram-post')}} data-lead-type="instagram" {{/if}}
    {{#if (includes lead.0._ref '_components/image')}} data-lead-orientation="{{lead.0.rendition}}" {{/if}}
  >
    {{#unless _computed.renderFullWidthLead }}
      {{#if _computed.supportsFullWidthLead }}
        <div data-editable="leadSettings">
          <h1>Lead Settings:</h1>
          <span>Full-Width Lead: {{if fullWidthLead 'Yes' else='No'}}</span>
        </div>
      {{/if}}

      <div class="body__header">
        {{! Lead }}
        <div class="lead" data-editable="lead">
          {{> component-list lead }}
        </div>
      </div>
    {{/unless}}

    <div class="body__info">
      {{! authors }}
      <div class="info--left-top">
        <div data-editable="bylinesAndStationLogo" class="info__by-authors{{#unless stationTitle}} info__by-authors--no-station{{/unless}}">
          {{{ byline bylines=byline authorHost=@root.locals.site.host showSocial=./showSocial }}}<!-- THIS IS TO ALLOW THE COMMA (Line 55) TO APPEAR INLINE WITHOUT WHITESPACE
          -->{{#each byline as |byline|}}<!--
            -->{{#each sources as |source|}}<!--
              --><span class="source">{{#ifAny byline.names.length @index}},{{/ifAny}} {{source.text}}</span>
            {{/each}}
          {{/each}}
          {{#if stationTitle}}<span>,</span>{{/if}}

          {{#if stationLogoUrl}}
            <div class="info__from-station">
              <a href="{{ striptags stationURL }}" target="_blank">
                <img class="from-station__logo" src="{{ stationLogoUrl }}?width=60&height=60&crop=1:1" />
              </a>
            </div>
          {{/if}}
        </div>

        {{! date and time }}
        <time class="info__timestamp" datetime="{{ date }}" itemprop="datePublished" data-editable="publishedDate">
          {{#if date}}
            {{#if dateUpdated}}
              <span class="timestamp__update">Updated on </span>
            {{/if}}
            {{#if (isPublished24HrsAgo date) }}
              <span class="timestamp__date timestamp__date--recent">{{{ timeAgoTimestamp date }}}</span>
            {{else}}
              <span class="timestamp__date timestamp__date--large">{{ formatLocalDate date 'MMMM D, YYYY' }}</span>
              <span class="timestamp__date timestamp__date--small">{{ formatLocalDate date 'MM/DD/YYYY' }}</span>
              <span class="timestamp__time">{{ formatLocalDate date 'h:mm a' }}</span>
            {{/if}}
          {{/if}}
        </time>
      </div>
      <div class="info--right-bottom">
        {{! Side Share }}
        {{> share sideShare }}
      </div>
    </div>
    <div class="body__content">
      <div class="content__info" data-editable="content">
        {{> component-list content }}
      </div>
      {{#if @root.locals.edit}}
        <section class="component__bulk-image-upload">
          <div class="content__bulk-image-upload" data-editable="bulkImageUpload"></div>
        </section>
      {{/if}}
      <div class="content__slides {{ if toggleEditorCondensedSlidesView 'content__slides--condensed' }}">
        {{#if @root.locals.edit}}
          {{! Adding slides components }}
          {{#if slides.length}}
            <section class="component__settings">
              <h2 class="settings__title">Gallery Settings</h2>
              <section class="settings__section" data-editable="slidesSettings">
                <h3 class="subtitle sub-edit">Slide Settings</h3>
                <ul class="items">
                  <li class="item">
                    <h4 class="item-title">Number the slides?</h4>
                    <p class="item-data">{{ slidesNumbered }}</p>
                  </li>
                  {{#if slidesNumbered}}
                    <li class="item">
                      <h4 class="item-title">Reverse number order? eg. 5, 4, 3...</h4>
                      <p class="item-data">{{ reverseOrder }}</p>
                    </li>
                  {{/if}}
                  <li class="item">
                    <h4 class="item-title">Add inline ads every 5 slides?</h4>
                    <p class="item-data">{{ includeInlineAds }}</p>
                  </li>
                  <li class="item">
                    <div role="alert" class="ui-alert ui-alert--type-warning">
                      <div class="ui-alert__body">
                          <div class="ui-alert__content">
                              Toggle on condensed slide view to reorder slides more easily. This does not change the look of the slides themselves when published on site.
                          </div>
                      </div>
                    </div>
                    <h4 class="item-title">Condensed Slide View?</h4>
                    <p class="item-data">{{ if toggleEditorCondensedSlidesView 'On' else='Off' }}</p>
                  </li>
                </ul>
              </section>
            </section>
          {{/if}}
          <div data-editable="slides">
            {{#each slides }}
                {{> (getComponentName this._ref) this }}
            {{/each}}
          </div>
        {{else}}
          {{#if slides.length }}
            {{#each slides }}
              {{#ifAll ../includeInlineAds (modulo @index 5 0) (compare ../slides.length "!==" (add @index 1)) }}
                <div class="slides__slide-group">
                  {{#if (compare @index '!==' 0) }}
                    <div class="slide-group__rr-ad-container">
                      {{> google-ad-manager ../rightRailStickyAd }}
                    </div>
                  {{/if}}
              {{/ifAll}}
                <div class="slide-group__slide-container"{{#if ../slidesNumbered}} {{#if ../reverseOrder}}data-slide-number='{{subtract ../slides.length @index}}'{{else}}data-slide-number='{{add @index 1}}'{{/if}}{{/if}}>
                  {{! Rendered slides }}
                  {{> (getComponentName this._ref) this }}
                </div>
              {{#ifAll ../includeInlineAds (modulo (add @index 1) 5 0) (compare ../slides.length "!==" (add @index 1)) }}
                </div>
                <div class="slides__ad-container">
                  {{> google-ad-manager ../inlineAd }}
                </div>
              {{/ifAll}}
            {{/each}}
          {{/if}}
        {{/if}}
      </div>

      {{#ifAny footer @root.locals.edit}}
        <div class="content__footer" data-editable="footer">
          {{> component-list footer }}
        </div>
      {{/ifAny}}

      {{! Tags }}
      {{> tags tags}}

      {{! Ad Tags }}
      {{> ad-tags adTags}}
    </div>

    {{! circulation area }}
    {{#if @root.locals.edit }}
      {{ set 'empty' '<span class="circulation--empty">None</span>' }}
      <section class="body__circulation">
        <h2 class="circulation__title">Gallery Circulation</h2>

        <section class="circulation__section" data-editable="circHeadlines">
          <h3 class="subtitle circ-edit">Headlines and Teasers</h3>
          <ul class="items">
            <li class="item">
              <h4 class="item-title required">Facebook Headline</h4>
              <p class="item-data">{{{ default primaryHeadline empty }}}</p>
            </li>
            <li class="item">
              <h4 class="item-title required">Twitter/Short Headline</h4>
              <p class="item-data">{{{ default shortHeadline empty }}}</p>
            </li>
            <li class="item">
              <h4 class="item-title required">Teaser</h4>
              <p class="item-data">{{{ default teaser empty }}}</p>
            </li>
            <li class="item">
              <h4 class="item-title required">SEO Headline</h4>
              <p class="item-data">{{{ default seoHeadline empty }}}</p>
            </li>
            <li class="item">
              <h4 class="item-title required">SEO Description</h4>
              <p class="item-data">{{{ default seoDescription empty }}}</p>
            </li>
          </ul>
        </section>

        <section class="circulation__section" data-editable="syndication">
          <h3 class="subtitle circ-edit">Syndication</h3>
          <ul class="items">
            <li class="item">
              <h4 class="item-title">Featured</h4>
              <p class="item-data">{{ yesNo featured }}</p>
            </li>
            <li class="item">
              <h4 class="item-title">Editorial Feeds Term(s)</h4>
              <p class="item-data">{{{ default (commaSeparated editorialFeeds false) empty }}}</p>
            </li>
            <li class="item">
              <h4 class="item-title">Syndicate to Corporate Website(s)</h4>
              <p class="item-data">{{{ default (commaSeparated corporateSyndication false) empty }}}</p>
            </li>
            <li class="item">
              <h4 class="item-title">Syndicate to Station(s)</h4>
              <p class="item-data">{{{ default (join stationSyndication) empty }}}</p>
            </li>
            <li class="item">
              <h4 class="item-title">Syndicate to Genre(s)</h4>
              <p class="item-data">{{{ default (join genreSyndication) empty }}}</p>
            </li>
            <li class="item">
              <h4 class="item-title">Syndication Status</h4>
              <p class="item-data">{{{ default syndicationStatus empty }}}</p>
            </li>
            <li class="item">
              <h4 class="item-title">Syndicated URL</h4>
              <p class="item-data">{{{ default syndicatedUrl empty }}}</p>
            </li>
          </ul>
        </section>

        <section class="circulation__section" data-editable="circSlug">
          {{#if slugLock}}
            <div class="alert alert-warning">
                <span style="vertical-align: sub;">{{{ read 'public/media/components/gallery/warning.svg' }}}</span>

                Gallery Slug is locked. Unlock in Gallery Settings.
            </div>
          {{/if}}
          <h3 class="subtitle circ-edit">Slug and URL</h3>
          <ul class="items">
            <li class="item">
              <h4 class="item-title required">Gallery Slug</h4>
              <p class="item-data">
                {{#if slug}}<span class="circulation-slug">{{ slug }}</span>{{else}}{{{ empty }}}{{/if}}
              </p>
            </li>
            <li class="item">
              <h4 class="item-title">Evergreen Treatment</h4>
              <p class="item-data">
                {{ yesNo evergreenSlug }}
              </p>
            </li>
          </ul>
        </section>

        <section class="circulation__section" data-editable="circFeeds">
          <h3 class="subtitle circ-edit">Recirculation:</h3>
          <ul class="items">
            <li class="item">
              <h4 class="item-title required">Recirculation Image</h4>
              <p class="item-data">
                {{#if feedImgUrl}}
                  <img class="feedimg" src="{{ feedImgUrl }}?width=300" alt="" />
                {{else}}
                  <div class="empty-feedimg"></div>
                {{/if}}
              </p>
            </li>
          </ul>
        </section>

        <section class="circulation__section" data-editable="circMetadata">
          <h3 class="subtitle circ-edit">Gallery Metadata</h3>
          <ul class="items">
            <li class="item">
              <h4 class="item-title required">Section Front</h4>
              <p class="item-data">{{ sectionFront }}</p>
            </li>
            <li class="item">
              <h4 class="item-title">Secondary Section Front</h4>
              <p class="item-data">{{ secondarySectionFront }}</p>
            </li>
          </ul>
        </section>
      </section>
    {{/if}}
  </section>
</section>
